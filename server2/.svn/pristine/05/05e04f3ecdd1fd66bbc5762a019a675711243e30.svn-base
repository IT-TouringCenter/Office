<?php
namespace App\Facades\Tours;

use App\Repositories\DayTripRepository as DayTripRepository;
use App\configuration_tour_price as configuration_tour_price;
use App\tour_program as tour_program;

class FooterClass extends BaseClass{
   public function __construct(DayTripRepository $repo){
      $this->DayTripRepository= $repo;     
    }

  public function GetFooter(){
    $footer_arr = [];
    $group = 'tour_category_id';
    $column = ['tour_program_id','tour_category_id'];
    $daytrip = $this->DaytripRepository->groupBy($group,$column);
    
    foreach($daytrip as $value){
      $this->daytrip = new configuration_tour_price;
      // $this->daytrip->tourId = $value->tour_program_id;
      // $this->daytrip->categoryId = $value->tour_category_id;
      $this->GetCategory($value->tour_category_id);
      $this->GetTourByCategory($value->tour_category_id);
      array_push($footer_arr,$this->daytrip);
    }
	    return $footer_arr;    
  }

  public function GetCategory($tour_category_id){
    $category = \TourCategoryFacade::GetTourCategory($tour_category_id);
    $this->daytrip->category = $category[0];
  }

  public function GetTourByCategory($tour_category_id){
    $tour = $this->DaytripRepository->GetTourByCategory($tour_category_id);
    // $count = $tour->count();
    // $this->daytrip->tours = $tour[0]->tour_program_id;

    $tour_arr = [];
    $column = ['id','code','title','link','image'];
    
    for($i=0;$i<$tour->count();$i++){
      $tour_program = \TourProgramFacade::GetTourProgramById($tour[$i]->tour_program_id,$column);
      foreach($tour_program as $val){
        $this->program = new tour_program;
        $this->program->tourId = $val->id;
        $this->program->code = $val->code;
        $this->program->title = $val->title;
        $this->program->link = $val->link;
        $this->program->image = $val->image;
        array_push($tour_arr,$this->program);
      }
    }
      $this->daytrip->tours = $tour_arr;
  }
}

?>